name: Setup Simply

on: [push, pull_request, workflow_dispatch]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
        with:
          repository: Amorfx/simply-docker
          ref: main
          path: simply-docker
      - uses: actions/checkout@v2
        with:
          path: simply-docker/simply
      - name: Build and run
        run: docker compose up --build -d
        working-directory: simply-docker
#      - name: Wait for install
#        run: sleep 90
#        working-directory: simply-docker
      - name: Verify install
        run: docker run --network container:simply appropriate/curl -s --retry 10 --retry-connrefused http://127.0.0.1 | grep "<title>simply"
        working-directory: simply-docker
